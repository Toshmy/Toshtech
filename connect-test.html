<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AppKit Connect Test (esm.sh)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { background:#0c1222; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; }
    .wrap { max-width: 720px; margin: 40px auto; padding: 24px; }
    .card { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:16px; }
  </style>

  <!-- Initialize AppKit BEFORE rendering the button -->
  <script type="module">
    import { createAppKit, getWalletProvider } from 'https://esm.sh/@reown/appkit@1.7.19';
    import { WagmiAdapter } from 'https://esm.sh/@reown/appkit-adapter-wagmi@1.1.4';

    const projectId = '6e2df48125e4f633b093361ba0a87c81'; // your WC project id

    // Custom PEPU testnet (Viem-style chain object)
    const pepuTestnet = {
      id: 97741,
      name: 'PEPU Testnet',
      rpcUrls: { default: { http: ['https://rpc-pepu-v2-testnet-vn4qxxp9og.t.conduit.xyz'] } },
      nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 }
    };

    const metadata = {
      name: 'ToshLock',
      description: 'Lock tokens with ToshLock',
      url: location.origin,
      icons: ['https://walletconnect.com/walletconnect-logo.png']
    };

    // Create adapter + AppKit (must happen before <appkit-button/>)
    const wagmi = new WagmiAdapter({ projectId, networks: [pepuTestnet] });
    const modal = createAppKit({
      adapters: [wagmi],
      networks: [pepuTestnet],
      projectId,
      metadata,
      features: { analytics: true }
    });

    // Expose provider for ethers/web3 use
    window.toshlockProvider = getWalletProvider('eip155');

    // Update small status text on account change
    window.addEventListener('eip155:accountsChanged', (e) => {
      const a = e.detail?.accounts || [];
      const el = document.getElementById('status');
      el.textContent = a.length ? `Connected: ${a[0].slice(0,6)}â€¦${a[0].slice(-4)}` : 'Not connected';
    });
  </script>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ”Œ Connect</h1>
    <div class="card">
      <!-- Official AppKit web component -->
      <appkit-button label="Connect Wallet"></appkit-button>
      <div id="status" style="margin-top:10px;font-size:12px;opacity:.85">Not connected</div>
    </div>
  </div>

  <!-- Optional: ethers v5 for quick testing -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // example: get signer after you click Connect
    async function testSigner(){
      const provider = new ethers.providers.Web3Provider(window.toshlockProvider, 'any');
      const signer = provider.getSigner();
      console.log('address:', await signer.getAddress());
    }
    // window.testSigner = testSigner;
  </script>
</body>
</html>
