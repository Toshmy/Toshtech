<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KQGNWXWKPM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KQGNWXWKPM');
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NCRKWCRS');</script>
<!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>$TOSH | Empowering $PEPU L2</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <style>
    html, body {
      background: radial-gradient(circle at center, #1a2238 0%, #0c1222 80%);
      color: white;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }
	nav {
	  position: fixed;
	  left: 0;
	  width: 100%;
	  z-index: 60;
	  top: 4.5rem; /* default fallback */
	  background: rgba(0,0,0,0.8);
	  backdrop-filter: blur(6px);
	}
    .glow-text {
      text-shadow: 0 0 12px #00ffae, 0 0 24px #00ffae;
    }

    .tech-glass {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(0, 255, 174, 0.2);
      backdrop-filter: blur(6px);
      border-radius: 1rem;
      box-shadow: 0 0 30px rgba(0, 255, 174, 0.2);
    }
  .banner {
    white-space: nowrap;       /* Prevent line breaks */
    overflow: hidden;          /* Hide overflow text */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 50;
    background: #000;          /* Optional background */
    color: #00ffae;            /* Optional text color */
  }

  .banner-text {
    display: inline-block;
    padding-left: 100%;       /* Start from outside the right edge */
    animation: scroll-left 15s linear infinite;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-100%);
    }
  }

    @keyframes pulseGlow {
      0% { box-shadow: 0 0 10px #00ffae, 0 0 20px #00ffae; }
      50% { box-shadow: 0 0 20px #00ffae, 0 0 40px #00ffae; }
      100% { box-shadow: 0 0 10px #00ffae, 0 0 20px #00ffae; }
    }

    .glow-ring {
      animation: pulseGlow 3s infinite;
    }

    @keyframes sip {
      0%, 100% { transform: rotate(-7deg); }
      10% { transform: rotate(0deg); }
      20% { transform: rotate(-7deg); }
    }

	#cup-arm {
	  position: absolute;
	  left: 200px;
	  top: 185px;
	  width: 230px;

	  animation: sip 10s infinite, slightShake 2s infinite;
	  z-index: 20;
	}
	@media (max-width: 1024px){
	  .nav-has-dropdown .nav-dropdown{
		left: 50%;
		right: auto;
		transform: translate(-50%, 6px);
		min-width: 16rem;
		text-align:center;
	  }
	}
	@media (max-width: 768px) {
	  #cup-arm { 
		top: 55%;
		left: 40%;
		width: 180px;
	  }
	}


    .coin {
      position: absolute;
      height: 60px;
      width: 60px;
      animation: fall 6s linear forwards;
      opacity: 0.85;
      z-index: 10;
    }

    @keyframes fall {
      0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }

    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(40px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .animate-fadeIn {
      animation: fadeIn 1.2s ease forwards;
    }
/* Desktop dropdown for ToshLock */
  .nav-has-dropdown { position: relative; }
  .nav-dropdown{
    position:absolute; right:0; top:100%; margin-top:.5rem;
    /* darker, more opaque glass for readability */
    background: rgba(3, 10, 22, 0.92);
    border: 1px solid rgba(0,255,174,.25);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: .75rem;
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.45), 0 0 0 1px rgba(0,255,174,.08) inset;
    padding:.5rem; min-width:14rem;
    opacity:0; visibility:hidden; transform: translateY(6px);
    transition: opacity .15s ease, transform .15s ease, visibility 0s linear .15s;
    z-index: 80; /* above nav & banner */
  }
  .nav-has-dropdown:hover .nav-dropdown,
  .nav-has-dropdown:focus-within .nav-dropdown{
    opacity:1; visibility:visible; transform: translateY(0);
    transition-delay:0s;
  }
  .nav-dropdown a{
    display:block; padding:.6rem .8rem; border-radius:.6rem;
    color:#eafff7; /* strong contrast */
  }
  .nav-dropdown a:hover{ background: rgba(255,255,255,.08); }

  /* 2) Mobile: center the ToshLock area and its links */
  @media (max-width: 768px){
    /* Center the accordion toggle row content */
    #ml-toshlock-toggle{
      justify-content: center !important;
      text-align:center;
    }
    /* Center the panel and its items */
    #ml-toshlock-panel{
      text-align:center;
      padding-left: 0 !important; /* remove left indent */
    }
    #ml-toshlock-panel a{
      display:inline-block;
      width: 90%;
      max-width: 420px;
      margin: 0 auto;
      text-align:center;
      padding:.6rem .9rem;
      border:1px solid rgba(0,255,174,.18);
      background: rgba(3,10,22,.75);
      border-radius:.6rem;
    }
    #ml-toshlock-panel a + a{ margin-top:.4rem; }
  }
  </style>

</head>

<body class="min-h-screen overflow-hidden">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCRKWCRS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->	
<div class="banner min-h-[4.5rem] flex items-center justify-start px-4">
  <div class="banner-text text-lg font-semibold glow-text">
    🚧 $TOSH — Built by Tosh Tech, We’re delivering the tools Pepu communities deserve 
  </div>
</div>

<!-- Navigation -->
<nav class="fixed top-[4.5rem] left-0 w-full bg-black bg-opacity-80 backdrop-blur-md z-60">
  <div class="max-w-4xl mx-auto px-4">
    <div class="flex items-center justify-between py-3">
      <div class="text-white font-bold text-lg">Menu</div>
      <button id="menu-toggle" class="md:hidden text-white focus:outline-none">
        <!-- Hamburger icon -->
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
		<div class="hidden md:flex items-center gap-6 text-white font-semibold relative">
		  <a href="index.html" class="hover:text-green-400">Home</a>
		  <a href="roadmap.html" class="hover:text-green-400">Roadmap</a>
		  <a href="tokenomic.html" class="hover:text-green-400">Tokenomic</a>
		  <a href="tools.html" class="hover:text-green-400">Tools</a>
		  <a href="toshguard.html" class="hover:text-green-400">ToshGuard</a>

		  <!-- ToshLock dropdown -->
		  <div class="nav-has-dropdown">
			<button class="hover:text-green-400 flex items-center gap-1 focus:outline-none" aria-haspopup="true" aria-expanded="false">
			  ToshLock
			  <svg class="w-4 h-4 opacity-80" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
			  </svg>
			</button>
			<div class="nav-dropdown tech-glass">
			  <a href="toshlock.html" class="hover:text-green-300">ToshLock (Locker)</a>
			  <a href="toshdashboard.html" class="hover:text-green-300">ToshDashboard</a>
			  <a href="toshrank.html" class="hover:text-green-300">ToshRank</a>
			</div>
		  </div>

		  <a href="how-to-buy.html" class="hover:text-green-400">How to buy</a>
		</div>

    </div>
    <!-- Mobile menu -->
<div id="mobile-menu" class="hidden flex-col md:hidden pb-4 space-y-3 text-center text-white font-semibold">

  <a href="index.html" class="block hover:text-green-400">Home</a>
  <a href="roadmap.html" class="block hover:text-green-400">Roadmap</a>
  <a href="tokenomic.html" class="block hover:text-green-400">Tokenomic</a>
  <a href="tools.html" class="block hover:text-green-400">Tools</a>
  <a href="toshguard.html" class="block hover:text-green-400">ToshGuard</a>

  <!-- ToshLock accordion -->
  <div class="text-left px-4">

	<button id="ml-toshlock-toggle"
	  class="w-full flex items-center justify-between md:justify-between justify-center
			 py-2 px-3 rounded bg-black bg-opacity-30 hover:bg-opacity-40">
	  <span>ToshLock</span>
	  <svg id="ml-toshlock-caret" class="w-4 h-4 transform transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
		<path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
	  </svg>
	</button>
	
    <div id="ml-toshlock-panel" class="hidden pl-3 mt-2 space-y-2">
      <a href="toshlock.html" class="block py-2 px-3 rounded hover:bg-white hover:bg-opacity-10">ToshLock (Locker)</a>
      <a href="toshdashboard.html" class="block py-2 px-3 rounded hover:bg-white hover:bg-opacity-10">ToshDashboard</a>
      <a href="toshrank.html" class="block py-2 px-3 rounded hover:bg-white hover:bg-opacity-10">ToshRank</a>
    </div>
  </div>

  <a href="how-to-buy.html" class="block hover:text-green-400">How to buy</a>
</div>
  </div>
</nav>

<div class="fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-2 bg-black bg-opacity-50 rounded-full glow-text text-sm font-semibold animate-pulse z-40 whitespace-nowrap">
  ⚡ ToshLock is live  ⚡
</div>
  

  <div class="w-full px-4 pt-32 pb-8 text-center">
    <div class="max-w-2xl mx-auto tech-glass p-6 glow-text animate-fadeIn">
      <h2 class="text-2xl md:text-3xl font-bold mb-4 text-green-200">Pepe Unchained x Tosh Tech</h2>
      <p class="text-lg md:text-xl text-green-100 mb-2">Free & Premium Tools for PEPU</p>
      <p class="italic text-green-300">Utility. Innovation. Community.</p>
		<div class="relative mx-auto max-w-md">
			<img src="assets/TOSH-image.png" alt="$TOSH mascot" class="w-full">
			<img src="assets/cup-arm.png" alt="Cup Arm" id="cup-arm" class="absolute">
		</div>
<!-- Disclaimer
			<h2 class="text-1xl text-green-400 font-semibold mb-4">🚀 Next Official Announcement In:</h2>
		<div id="countdown" class="text-1xl font-bold glow-text">
		</div>
 -->
    </div>

  </div>
  
<div class="w-full px-4 pb-16 text-center">
  <div class="max-w-xl mx-auto tech-glass p-6 glow-text animate-fadeIn space-y-4">
    <h2 class="text-2xl md:text-3xl font-bold text-green-200 mb-4">$TOSH Token Metrics (Live)</h2>
    


	<div class="grid grid-cols-2 gap-4 text-green-100 text-left">

	  <!-- SECTION: Price & Performance -->
	  <div class="col-span-2 text-green-300 uppercase text-xs tracking-wide border-t border-white border-opacity-10 pt-2">Price & Performance</div>
	  <div><span class="font-semibold text-green-300">$</span> <span id="price">--</span></div>
	  <div><span class="font-semibold text-green-300">24h Change:</span> <span id="priceChange">--</span></div>
	  <div><span class="font-semibold text-green-300">24h Vol.:</span> <span id="volume">--</span><span>$</span></div>
	  <div><span class="font-semibold text-green-300">Liquidity:</span> <span id="liquidity">--</span><span>$</span></div>

	  <!-- SECTION: Market Cap & Supply -->
	  <div class="col-span-2 text-green-300 uppercase text-xs tracking-wide border-t border-white border-opacity-10 pt-2">Market Cap & Supply</div>
	  <div><span class="font-semibold text-green-300">Circ. MC:</span> <span id="circMC">--</span><span>$</span></div>
	  <div><span class="font-semibold text-green-300">MC (FDV):</span> <span id="fdv">--</span><span>$</span></div>
	  <div><span class="font-semibold text-green-300">Circ. Supply:</span> <span id="circSupply">--</span></div>
	  <div><span class="font-semibold text-green-300">Holders:</span> <span id="holders">--</span></div>

	  <!-- SECTION: Ownership & Locks -->
	  <div class="col-span-2 text-green-300 uppercase text-xs tracking-wide border-t border-white border-opacity-10 pt-2">Ownership & Locks</div>
	  <div><span class="font-semibold text-green-300">Top-10 Share:</span> <span id="top10Share">--</span></div>
	  <div><span class="font-semibold text-green-300">Whale HHI (Top10):</span> <span id="hhi">--</span></div>
	  <div><span class="font-semibold text-green-300">Locked % / Days:</span> <span id="lockedPct">--</span> / <span id="avgLockDays">--</span></div>
	  <div><span class="font-semibold text-green-300">Age:</span> <span id="ageDays">--</span> days</div>

	  <!-- SECTION: Efficiency -->
	  <div class="col-span-2 text-green-300 uppercase text-xs tracking-wide border-t border-white border-opacity-10 pt-2">Efficiency</div>
	  <div><span class="font-semibold text-green-300">Liq / CircMC:</span> <span id="liqToMC">--</span></div>
	  <div><span class="font-semibold text-green-300">24h Turnover:</span> <span id="turnover">--</span></div>

	  <!-- Timestamp -->
	  <div class="col-span-2 text-right text-xs text-green-400">As of <span id="updatedAt">--</span></div>
	</div>

    <p class="text-green-400 text-sm mt-4 italic">Live data from official sources. Updates every 15 minutes.</p>
  </div>
</div>
<div class="fixed bottom-14 left-1/2 transform -translate-x-1/2 flex justify-center gap-2 whitespace-nowrap z-50">
  <a href="https://t.me/ToshTech" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded-full font-semibold shadow-xl transition text-sm">Telegram 💬</a>
  <a href="https://x.com/ToshTech_" target="_blank" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:opacity-100 text-white px-2 py-1 rounded-full font-semibold shadow-xl transition flex items-center gap-1 text-sm">Twitter 🐦</a>
  <a href="https://www.geckoterminal.com/pepe-unchained/pools/0x36337e694b3b1eadde50101e8aa4f4fa74463aee" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white px-2 py-1 rounded-full font-semibold shadow-xl transition text-sm">Chart 📈</a>
 <a href="https://pepuswap.com//#/swap?inputCurrency=ETH&outputCurrency=0x0b52dfa17542f30f3072c53ca5061120c74d86e9" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded-full font-semibold shadow-xl transition text-sm">Buy 🛒</a>
</div>

  <audio id="hover-sound" src="assets/hover.mp3" preload="auto"></audio>

<!-- Disclaimer -->
<div class="text-center text-xs text-gray-400 max-w-2xl mx-auto px-2">
  <p class="mb-2">Disclaimer: $TOSH is a community-driven project. Participation involves risk. Not financial advice. DYOR.</p>
</div>
<script>
// Mobile "ToshLock" accordion
const mlToggle = document.getElementById('ml-toshlock-toggle');
const mlPanel  = document.getElementById('ml-toshlock-panel');
const mlCaret  = document.getElementById('ml-toshlock-caret');

if (mlToggle && mlPanel && mlCaret) {
  mlToggle.addEventListener('click', () => {
    mlPanel.classList.toggle('hidden');
    mlCaret.classList.toggle('rotate-180');
  });
}
window.addEventListener('DOMContentLoaded', () => {
  const introSound = document.getElementById('intro-sound');
  const hoverSound = document.getElementById('hover-sound');

  if (hoverSound) {
    hoverSound.volume = 0.1;
    hoverSound.play().catch(() => {});
    hoverSound.pause();
    hoverSound.currentTime = 0;
  }

  if (introSound) {
    const playIntro = () => {
      introSound.volume = 0.5;
      introSound.play().catch(() => {});
      document.removeEventListener('click', playIntro);
    };
    document.addEventListener('click', playIntro);
  }

  const socialBtns = document.querySelectorAll('a');
  socialBtns.forEach(btn => {
    btn.addEventListener('mouseenter', () => {
      if (!hoverSound) return;
      hoverSound.currentTime = 0;
      hoverSound.play().catch(() => {});
    });
  });
});

document.addEventListener("DOMContentLoaded", () => {
  // Toggle mobile menu
  const toggleBtn = document.getElementById('menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  toggleBtn.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });

  // Adjust nav top based on banner height
  const banner = document.querySelector('.banner');
  const nav = document.querySelector('nav');
  function updateMenuTop() {
    const bannerHeight = banner.offsetHeight;
    nav.style.top = bannerHeight + 'px';
  }
  window.addEventListener('resize', updateMenuTop);
  updateMenuTop(); // initial call

  // Hover sound on links
  const socialBtns = document.querySelectorAll('a');
  const hoverSound = document.getElementById('hover-sound');
  socialBtns.forEach(btn => {
    btn.addEventListener('mouseenter', () => {
      hoverSound.currentTime = 0;
      hoverSound.play();
    });
  });
// Highlight active link (desktop + mobile)
(() => {
  const path = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('nav a[href]').forEach(a => {
    if (a.getAttribute('href') === path) {
      a.classList.add('text-green-400');
    }
  });
})();

const targetDate = new Date('2025-07-09T14:00:00Z');
// OR for 48 hours from now, use:
// const targetDate = new Date(); targetDate.setHours(targetDate.getHours() + 48);

const countdown = document.getElementById('countdown');
const interval = setInterval(() => {
  const now = new Date().getTime();
  const distance = targetDate - now;

  if (distance < 0) {
    clearInterval(interval);
    countdown.innerText = "🔥 It's Time 🔥";
    return;
  }

  const days = Math.floor(distance / (1000 * 60 * 60 * 24));
  const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  const seconds = Math.floor((distance % (1000 * 60)) / 1000);

  countdown.innerText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
}, 1000);


  // Animate cup arm with random duration and delay
  const cup = document.getElementById("cup-arm");
  const duration = (4 + Math.random() * 6).toFixed(1);
  const delay = (Math.random() * 2).toFixed(1);
  cup.style.animationDuration = `${duration}s`;
  cup.style.animationDelay = `${delay}s`;
});


async function loadToshMetricsUnified() {
  const CA_TOSH   = '0x0b52dfa17542f30f3072c53ca5061120c74d86e9'.toLowerCase();
  const POOL_ADDR = '0x36337e694b3b1eadde50101e8aa4f4fa74463aee'.toLowerCase();
  const SNAP_URL  = 'https://toshboard-snapshot.toshtech777.workers.dev/snapshot.json';
  const POOLS_URL = 'https://www.toshtech.xyz/pools_cache.json';

  const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
  const colorize = (el, value) => { if (!el) return; el.style.color = value > 0 ? 'limegreen' : value < 0 ? 'red' : 'inherit'; };

  // Recursively collect all objects that look like pool entries
  const collectCandidates = (node, acc = []) => {
    if (!node) return acc;
    if (Array.isArray(node)) {
      node.forEach(n => collectCandidates(n, acc));
    } else if (typeof node === 'object') {
      // If it looks like a pool/token object, record it
      const hasAnyKey = ('symbol' in node) || ('address' in node) || ('pool_address' in node) || ('name' in node) || ('price_changes' in node);
      if (hasAnyKey) acc.push(node);
      // Recurse into values
      Object.values(node).forEach(v => {
        if (v && (typeof v === 'object')) collectCandidates(v, acc);
      });
    }
    return acc;
  };

  const findToshPool = (root) => {
    const list = collectCandidates(root);
    const match = list.find(p => {
      const addr = (p?.address || '').toLowerCase();
      const pool = (p?.pool_address || '').toLowerCase();
      const sym  = (p?.symbol || '').toUpperCase();
      const name = (p?.name || '').toUpperCase();
      return (
        addr === CA_TOSH ||
        pool === POOL_ADDR ||
        sym === 'TOSH' ||
        name.includes('TOSH')
      );
    });
    return match || null;
  };

  const parsePct = (v) => {
    if (v == null) return NaN;
    const n = Number(String(v).replace(/[^0-9+.\-]/g, ''));
    return Number.isFinite(n) ? n : NaN;
  };

  try {
    const [snapRes, poolsRes] = await Promise.all([
      fetch(`${SNAP_URL}?t=${Date.now()}`,  { cache: 'no-store' }),
      fetch(`${POOLS_URL}?t=${Date.now()}`, { cache: 'no-store' }),
    ]);

    // snapshot.json
    let snapItem = null, snapComputedAt = null;
    if (snapRes.ok) {
      const snap = await snapRes.json();
      snapComputedAt = Number(snap.computedAt || 0) || null;
      const items = Array.isArray(snap.items) ? snap.items : [];
      snapItem = items.find(i =>
        (i?.pool?.symbol || '').toUpperCase() === 'TOSH' ||
        ((i?.ca || '').toLowerCase() === CA_TOSH)
      ) || null;
    }

    // pools_cache.json (any shape)
    let poolRoot = null, poolItem = null, poolUpdatedAt = null;
    if (poolsRes.ok) {
      poolRoot = await poolsRes.json();
      poolItem = findToshPool(poolRoot);
      // Try to read last_updated if present anywhere on the matched node
      const lu = poolItem?.last_updated;
      poolUpdatedAt = lu ? Number(lu) * 1000 : null;
    }

    // Log what we found (dev help)
    console.debug('pools_cache poolItem →', poolItem);

    // Base values (prefer pools for live market fields)
    const price   = Number(poolItem?.price ?? snapItem?.price ?? NaN);
    const fdv     = Number(snapItem?.market_cap ?? poolItem?.market_cap ?? NaN);
    const liq     = Number(poolItem?.reserve_in_usd ?? snapItem?.reserve ?? NaN);
    const vol24   = Number(poolItem?.volume_24h_usd ?? snapItem?.vol24 ?? NaN);
    const holders = Number(snapItem?.holders ?? NaN);

    // Robust 24h change extraction
    let h24Raw = null;
    if (poolItem) {
      h24Raw =
        poolItem?.price_changes?.h24 ??
        poolItem?.price_change?.h24 ??
        poolItem?.priceChange?.h24 ??
        poolItem?.h24_change ??
        poolItem?.change_24h ?? null;
    }
    const h24 = parsePct(h24Raw);
    console.debug('raw h24 →', h24Raw, 'parsed →', h24);

    // Circulating supply & cap (snapshot)
    const totalN  = Number(snapItem?.totalN ?? 0);
    const burnedN = Number(snapItem?.burnedN ?? 0);
    const lockedN = Number(snapItem?.lockedN ?? 0);
    const manualLockedN = Number(snapItem?.manualLockedN ?? 0);
    const circSupply = Math.max(0, totalN - burnedN - lockedN - manualLockedN);
    const circMC = isFinite(price) ? price * circSupply : NaN;

    // Locks & concentration (snapshot)
    const lockedPct   = Number(snapItem?.lockedPct ?? NaN);
    const avgLockDays = Number(snapItem?.avgLockDays ?? NaN);
    const top10Share  = Number(snapItem?.top10Share ?? NaN);

    // Whale HHI (snapshot)
    const topHolders = Array.isArray(snapItem?.topHolders) ? snapItem.topHolders : [];
    const hhi = topHolders.reduce((acc, h) => {
      const f = Number(h.pctCirc || 0) / 100; return acc + f*f;
    }, 0);

    // Age (snapshot)
    const creationTsMs = Number(snapItem?.creationTs || 0) * 1000;
    const ageDays = creationTsMs ? Math.max(0, Math.floor((Date.now() - creationTsMs) / 86400000)) : NaN;

    // Ratios
    const liqToMC  = isFinite(circMC) && circMC > 0 ? liq / circMC : NaN;
    const turnover = isFinite(circMC) && circMC > 0 ? vol24 / circMC : NaN;

    // Freshness
    const stamp = Math.max(
      Number(snapItem?.computedAt || 0) || 0,
      Number(snapComputedAt || 0) || 0,
      Number(poolUpdatedAt || 0) || 0
    );
    const updatedAt = stamp ? new Date(stamp).toLocaleString() : '--';

    // Populate DOM
    setText('holders', isFinite(holders) ? holders.toLocaleString() : '--');
    setText('price',   isFinite(price)   ? price.toFixed(8) : '--');
    setText('fdv',     isFinite(fdv)     ? fdv.toLocaleString(undefined, { maximumFractionDigits: 2 }) : '--');
    setText('volume',  isFinite(vol24)   ? vol24.toLocaleString(undefined, { maximumFractionDigits: 2 }) : '--');
    setText('liquidity', isFinite(liq)   ? liq.toLocaleString(undefined, { maximumFractionDigits: 2 }) : '--');

    const pcEl = document.getElementById('priceChange');
    if (Number.isFinite(h24)) {
      setText('priceChange', `${h24.toFixed(2)}%`);
      colorize(pcEl, h24);
    } else {
      setText('priceChange', '--');
      if (pcEl) pcEl.style.color = '';
    }

    setText('circSupply', circSupply ? circSupply.toLocaleString() : '--');
    setText('circMC', isFinite(circMC) ? circMC.toLocaleString(undefined, { maximumFractionDigits: 2 }) : '--');

    setText('lockedPct',   isFinite(lockedPct)   ? `${lockedPct.toFixed(2)}%` : '--');
    setText('avgLockDays', isFinite(avgLockDays) ? `${Math.round(avgLockDays)}d` : '--');

    setText('top10Share', isFinite(top10Share) ? `${top10Share.toFixed(2)}%` : '--');
    const top10El = document.getElementById('top10Share');
    if (top10El && isFinite(top10Share)) {
      top10El.style.color = top10Share > 50 ? 'red' : top10Share > 33 ? 'orange' : 'limegreen';
    }

    setText('ageDays', isFinite(ageDays) ? String(ageDays) : '--');
    setText('liqToMC',  isFinite(liqToMC)  ? liqToMC.toFixed(3) : '--');
    setText('turnover', isFinite(turnover) ? turnover.toFixed(3) : '--');

    setText('hhi', hhi ? hhi.toFixed(3) : '--');
    const hhiEl = document.getElementById('hhi');
    if (hhiEl && hhi) {
      hhiEl.style.color = hhi > 0.06 ? 'red' : hhi > 0.025 ? 'orange' : 'limegreen';
    }

    setText('updatedAt', updatedAt);
  } catch (e) {
    console.error('Unified loader error:', e);
  }
}

// initial run + 15-min refresh
loadToshMetricsUnified();
setInterval(loadToshMetricsUnified, 15 * 60 * 1000);
</script>


</body>
</html>
